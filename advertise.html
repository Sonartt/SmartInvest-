<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advertise on SmartInvest - Purchase Ad Space</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì¢</text></svg>">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    .header {
      background: white;
      padding: 30px;
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      text-align: center;
    }
    .header h1 { color: #667eea; margin-bottom: 10px; }
    
    .packages-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .package-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      transition: transform 0.3s;
      cursor: pointer;
      border: 3px solid transparent;
    }
    .package-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    .package-card.selected {
      border-color: #667eea;
      background: #f0f4ff;
    }
    .package-name {
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 15px;
    }
    .pricing-list {
      list-style: none;
      margin: 15px 0;
    }
    .pricing-list li {
      padding: 8px 0;
      border-bottom: 1px solid #f0f0f0;
      display: flex;
      justify-content: space-between;
    }
    .pricing-list li:last-child { border-bottom: none; }
    .price { font-weight: bold; color: #10b981; }
    
    .features-list {
      list-style: none;
      margin-top: 15px;
    }
    .features-list li {
      padding: 5px 0;
      padding-left: 20px;
      position: relative;
      font-size: 14px;
      color: #666;
    }
    .features-list li:before {
      content: "‚úì";
      position: absolute;
      left: 0;
      color: #10b981;
      font-weight: bold;
    }
    
    .form-section {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      display: none;
    }
    .form-section.active { display: block; }
    
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 15px;
      font-family: inherit;
      background-color: #FFFFFF;
      color: #1E293B;
      transition: all 0.2s ease;
    }

    /* Mobile responsiveness - prevent zoom on input focus */
    @media (max-width: 768px) {
      .form-group input,
      .form-group select,
      .form-group textarea {
        font-size: 16px;
      }
    }

    /* Placeholder styling */
    .form-group input::placeholder,
    .form-group textarea::placeholder {
      color: #64748B;
      opacity: 1;
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    /* Validation states */
    .form-group input:invalid:not(:placeholder-shown),
    .form-group textarea:invalid:not(:placeholder-shown) {
      border-color: #DC2626;
      background-color: #FEF2F2;
    }

    .form-group input:invalid:not(:placeholder-shown):focus,
    .form-group textarea:invalid:not(:placeholder-shown):focus {
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
    }

    .form-group input:valid:not(:placeholder-shown),
    .form-group textarea:valid:not(:placeholder-shown) {
      border-color: #059669;
      background-color: #F0FDF4;
    }

    /* Auto-fill styling */
    .form-group input:-webkit-autofill,
    .form-group input:-webkit-autofill:hover,
    .form-group input:-webkit-autofill:focus {
      -webkit-box-shadow: 0 0 0 30px white inset !important;
      -webkit-text-fill-color: #1E293B !important;
    }

    /* Error message styling */
    .error-message {
      color: #DC2626;
      font-size: 0.875rem;
      margin-top: 0.25rem;
      display: none;
    }

    .form-group input.error ~ .error-message,
    .form-group textarea.error ~ .error-message {
      display: block;
    }
    
    .cost-summary {
      background: #f0f4ff;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
    }
    .cost-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      font-size: 16px;
    }
    .cost-total {
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
      border-top: 2px solid #667eea;
      padding-top: 15px;
      margin-top: 15px;
    }
    
    .btn {
      padding: 14px 28px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-primary {
      background: #667eea;
      color: white;
      width: 100%;
    }
    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    .btn-secondary {
      background: #f3f4f6;
      color: #333;
      margin-right: 10px;
    }
    
    .alert {
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
    }
    .alert-success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #10b981;
    }
    .alert-error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #ef4444;
    }
    .alert-info {
      background: #dbeafe;
      color: #1e40af;
      border: 1px solid #3b82f6;
    }
    
    .step-indicator {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
    }
    .step {
      padding: 10px 20px;
      margin: 0 10px;
      border-radius: 20px;
      background: white;
      font-weight: 600;
    }
    .step.active {
      background: #667eea;
      color: white;
    }
    
    .hidden { display: none; }
    
    @media (max-width: 768px) {
      .packages-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üì¢ Advertise on SmartInvest</h1>
      <p>Reach thousands of investors and financial professionals across Africa</p>
    </div>
    
    <div class="step-indicator">
      <div class="step active" id="step1-indicator">1. Choose Package</div>
      <div class="step" id="step2-indicator">2. Configure Ad</div>
      <div class="step" id="step3-indicator">3. Payment</div>
    </div>
    
    <!-- Step 1: Package Selection -->
    <div id="step1" class="packages-section">
      <h2 style="color: white; text-align: center; margin-bottom: 20px;">Choose Your Ad Package</h2>
      <div class="packages-grid" id="packagesGrid">
        <!-- Packages loaded dynamically -->
      </div>
      <div style="text-align: center; margin-top: 20px;">
        <button class="btn btn-primary" onclick="nextStep()" style="max-width: 300px;">Continue ‚Üí</button>
      </div>
    </div>
    
    <!-- Step 2: Ad Configuration -->
    <div id="step2" class="form-section">
      <h2 style="margin-bottom: 20px;">Configure Your Advertisement</h2>
      
      <div class="form-group">
        <label>Duration</label>
        <select id="duration" onchange="updateCostSummary()">
          <option value="">Select duration</option>
          <option value="day">1 Day</option>
          <option value="week">1 Week</option>
          <option value="month">1 Month</option>
          <option value="quarter">3 Months</option>
          <option value="year">1 Year</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Quantity</label>
        <input type="number" id="quantity" value="1" min="1" max="10" onchange="updateCostSummary()">
        <small style="color: #666;">Number of ad slots (max 10)</small>
      </div>
      
      <div class="form-group">
        <label>Ad Position</label>
        <select id="position">
          <option value="">Select position</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Company/Business Name</label>
        <input type="text" id="companyName" placeholder="Your Company Name" required>
      </div>
      
      <div class="form-group">
        <label>Your Name</label>
        <input type="text" id="advertiserName" placeholder="John Doe" required>
      </div>
      
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="advertiserEmail" placeholder="you@company.com" required>
      </div>
      
      <div class="form-group">
        <label>Phone Number</label>
        <input type="tel" id="advertiserPhone" placeholder="+254712345678" required>
      </div>
      
      <div class="form-group">
        <label>Ad Content/Message</label>
        <textarea id="adContent" placeholder="Your advertisement text or image URL..." required></textarea>
        <small style="color: #666;">HTML allowed for banner ads. Max 500 characters.</small>
      </div>
      
      <div class="form-group">
        <label>Target URL (where clicks go)</label>
        <input type="url" id="targetUrl" placeholder="https://yourwebsite.com" required>
      </div>
      
      <div class="cost-summary" id="costSummary">
        <h3 style="margin-bottom: 15px;">Cost Summary</h3>
        <div class="cost-row">
          <span>Package:</span>
          <span id="summaryPackage">-</span>
        </div>
        <div class="cost-row">
          <span>Duration:</span>
          <span id="summaryDuration">-</span>
        </div>
        <div class="cost-row">
          <span>Quantity:</span>
          <span id="summaryQuantity">-</span>
        </div>
        <div class="cost-row">
          <span>Unit Price:</span>
          <span id="summaryUnitPrice">-</span>
        </div>
        <div class="cost-row cost-total">
          <span>Total Cost:</span>
          <span id="summaryTotal">$0.00 USD</span>
        </div>
      </div>
      
      <div style="display: flex; gap: 10px;">
        <button class="btn btn-secondary" onclick="prevStep()">‚Üê Back</button>
        <button class="btn btn-primary" onclick="submitAdOrder()">Proceed to Payment ‚Üí</button>
      </div>
    </div>
    
    <!-- Step 3: Payment -->
    <div id="step3" class="form-section">
      <h2 style="margin-bottom: 20px;">Complete Payment</h2>
      
      <div id="paymentResult"></div>
      
      <div style="text-align: center; margin-top: 20px;">
        <button class="btn btn-secondary" onclick="location.reload()">Start New Order</button>
      </div>
    </div>
  </div>
  
  <script>
    let currentStep = 1;
    let selectedPackage = null;
    let packages = {};
    let calculatedCost = null;
    
    // Load packages on page load
    async function loadPackages() {
      try {
        const response = await fetch('/api/ads/packages');
        const data = await response.json();
        
        if (data.success) {
          packages = data.packages;
          renderPackages();
        }
      } catch (error) {
        console.error('Error loading packages:', error);
      }
    }
    
    function renderPackages() {
      const grid = document.getElementById('packagesGrid');
      grid.innerHTML = Object.entries(packages).map(([type, pkg]) => `
        <div class="package-card" onclick="selectPackage('${type}')">
          <div class="package-name">${pkg.name}</div>
          <div class="pricing-list">
            ${Object.entries(pkg.pricing).map(([dur, price]) => `
              <li>
                <span>${dur === 'day' ? '1 Day' : dur === 'week' ? '1 Week' : dur === 'month' ? '1 Month' : dur === 'quarter' ? '3 Months' : '1 Year'}</span>
                <span class="price">$${price}</span>
              </li>
            `).join('')}
          </div>
          ${pkg.features ? `
            <ul class="features-list">
              ${pkg.features.map(f => `<li>${f}</li>`).join('')}
            </ul>
          ` : ''}
          ${pkg.dimensions ? `<p style="margin-top: 10px; font-size: 13px; color: #999;">Dimensions: ${pkg.dimensions}</p>` : ''}
        </div>
      `).join('');
    }
    
    function selectPackage(type) {
      selectedPackage = type;
      document.querySelectorAll('.package-card').forEach(card => {
        card.classList.remove('selected');
      });
      event.currentTarget.classList.add('selected');
      
      // Update position options
      const pkg = packages[type];
      const positionSelect = document.getElementById('position');
      positionSelect.innerHTML = '<option value="">Select position</option>' +
        pkg.positions.map(pos => `<option value="${pos}">${pos}</option>`).join('');
    }
    
    function nextStep() {
      if (!selectedPackage) {
        alert('Please select an ad package');
        return;
      }
      
      currentStep = 2;
      updateStepDisplay();
      updateCostSummary();
    }
    
    function prevStep() {
      currentStep--;
      updateStepDisplay();
    }
    
    function updateStepDisplay() {
      document.getElementById('step1').style.display = currentStep === 1 ? 'block' : 'none';
      document.getElementById('step2').classList.toggle('active', currentStep === 2);
      document.getElementById('step3').classList.toggle('active', currentStep === 3);
      
      ['step1-indicator', 'step2-indicator', 'step3-indicator'].forEach((id, idx) => {
        document.getElementById(id).classList.toggle('active', idx + 1 === currentStep);
      });
    }
    
    async function updateCostSummary() {
      const duration = document.getElementById('duration').value;
      const quantity = parseInt(document.getElementById('quantity').value) || 1;
      
      if (!selectedPackage || !duration) {
        return;
      }
      
      try {
        const response = await fetch('/api/ads/calculate-cost', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ packageType: selectedPackage, duration, quantity })
        });
        
        const data = await response.json();
        
        if (data.success) {
          calculatedCost = data.cost;
          const pkg = data.cost.pricing;
          
          document.getElementById('summaryPackage').textContent = pkg.packageName;
          document.getElementById('summaryDuration').textContent = duration;
          document.getElementById('summaryQuantity').textContent = quantity;
          document.getElementById('summaryUnitPrice').textContent = `$${pkg.price} USD`;
          document.getElementById('summaryTotal').textContent = `$${data.cost.totalCost} USD`;
        }
      } catch (error) {
        console.error('Error calculating cost:', error);
      }
    }
    
    async function submitAdOrder() {
      const formData = {
        packageType: selectedPackage,
        duration: document.getElementById('duration').value,
        quantity: parseInt(document.getElementById('quantity').value) || 1,
        position: document.getElementById('position').value,
        companyName: document.getElementById('companyName').value,
        advertiserName: document.getElementById('advertiserName').value,
        advertiserEmail: document.getElementById('advertiserEmail').value,
        advertiserPhone: document.getElementById('advertiserPhone').value,
        adContent: document.getElementById('adContent').value,
        targetUrl: document.getElementById('targetUrl').value,
        currency: 'USD'
      };
      
      // Validate
      if (!formData.duration || !formData.position || !formData.advertiserName || 
          !formData.advertiserEmail || !formData.advertiserPhone || 
          !formData.adContent || !formData.targetUrl) {
        alert('Please fill all required fields');
        return;
      }
      
      try {
        const response = await fetch('/api/ads/initiate-payment', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        currentStep = 3;
        updateStepDisplay();
        
        if (data.success) {
          document.getElementById('paymentResult').innerHTML = `
            <div class="alert alert-success">
              <h3>‚úÖ Ad Order Created Successfully!</h3>
              <p><strong>Payment Reference:</strong> ${data.payment.reference}</p>
              <p><strong>Amount to Pay:</strong> ${data.payment.amount} ${data.payment.currency}</p>
              <p><strong>Payment Number:</strong> ${data.payment.platformNumber}</p>
              <p><strong>Package:</strong> ${data.payment.package}</p>
              <p><strong>Duration:</strong> ${data.payment.duration}</p>
              <p><strong>Valid Until:</strong> ${new Date(data.payment.validUntil).toLocaleDateString()}</p>
              <p style="margin-top: 15px;">${data.message}</p>
              <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px;">
                <p><strong>Next Steps:</strong></p>
                <ol style="margin-left: 20px; margin-top: 10px;">
                  <li>Send <strong>${data.payment.amount} ${data.payment.currency}</strong> via M-Pesa to <strong>${data.payment.platformNumber}</strong></li>
                  <li>Use reference: <strong>${data.payment.reference}</strong></li>
                  <li>Your ad will be reviewed and activated within 24 hours</li>
                  <li>You'll receive a confirmation email once approved</li>
                </ol>
              </div>
            </div>
          `;
        } else {
          document.getElementById('paymentResult').innerHTML = `
            <div class="alert alert-error">
              <h3>‚ùå Error</h3>
              <p>${data.error || 'Failed to create ad order'}</p>
            </div>
          `;
        }
      } catch (error) {
        document.getElementById('paymentResult').innerHTML = `
          <div class="alert alert-error">
            <h3>‚ùå Error</h3>
            <p>${error.message}</p>
          </div>
        `;
      }
    }
    
    // Load packages on page load
    window.addEventListener('load', loadPackages);
  </script>
</body>
</html>
